---
title: "Model Receptor Analysis"
output: html_document
params:
  model: "CANSAC-4km"
  modelRun: 20191119
  monitorID: NULL
  longitude: -121.46
  latitude: 38.55
  spatialDataDir: "~/Data/Spatial"
  modelDataDir: "~/Data/Bluesky"
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
lat <- params$latitude
lon <- params$longitude
model <- params$model
modelRun <- params$modelRun
```

```{r}
library(AirFireModeling)
```

```{r}
setModelDataDir('~/Data/Bluesky')
bs <- bluesky_load(modelRun = modelRun, cleanup = FALSE)
bs
```

```{r}
shiny::renderPlot({
  raster_spaghetti( bs, 
                    longitude = lon, 
                    latitude = lat, 
                    n = input$cell_count, 
                    snapToGrid = FALSE )
})
```

```{r}
shiny::sliderInput( "cell_count", 
                    label = "Cell Count",
                    min = 3, 
                    max = 25, 
                    value = 5, 
                    step = 1 )
```


```{r}
shiny::renderPlot({
  bs_cropped <- raster_subset( bs, 
                               longitude = lon, 
                               latitude = lat, 
                               radius = input$radius*1000)
  raster_facet( bs_cropped[[input$hours[1]:input$hours[2]]], 
                breaks = c(1,2,3,4,5,6,7,8,9,10) )
  })
```

```{r}
shiny::sliderInput( "radius", 
                    label = "Radius (km)",
                    min = 10, 
                    max = 250, 
                    value = 10, 
                    step = 1 )

shiny::sliderInput( 'hours', 
                    label = 'Select Hours', 
                    min  = 1, 
                    max = 72, 
                    value = c(1,12), 
                    dragRange = TRUE, 
                    )

```


