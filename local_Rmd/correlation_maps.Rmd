---
title: "Correlation Maps"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

suppressPackageStartupMessages({
  library(MazamaCoreUtils)
  library(PWFSLSmoke)
  library(AirFireModeling)
})

setModelDataDir('~/Data/Bluesky')
initializeMazamaSpatialUtils()
```

In this example, we will demonstrate the use of correlation maps. In particular, 
we will look at correlations among a `ws_monitor` site and our `bs_grid` of bluesky 
model data. 

To start, lets look at a region and timeframe that is significantly affected by 
wildfire smoke in order to gain a sense of what correlations mean.
```{r}
pollock_pines <-
      monitor_load(20191014, 20191015) %>%
      monitor_subset(monitorIDs = "lon_.120.591_lat_38.714_arb2.1008")

bs_grid <- bluesky_load(model = 'CANSAC-1.33km',modelRun = 20191014)

grid_correlationMap(bs_grid = bs_grid, ws_monitor = pollock_pines, plotter = 'gg')
```
Just as the legend states, red is a postive correlation with the monitor reading 
(highlighted with a black square) and blue is a negative correlation. White (0.0) 
is no correlation. We can see that in the area surronding the monitor, there is a 
strong correlation to the model output and the monitor's reading.

Let's try a monitor that does not correlate well to its region. 
```{r}
other_monitor <- monitor_load(20190905, 20190907) %>%
  monitor_subset(monitorIDs = '060131004_01')

bs_grid <- bluesky_load(model = 'CANSAC-1.33km',modelRun = 20190905, subDir = 'forecast')

grid_correlationMap(bs_grid = bs_grid, ws_monitor = other_monitor, plotter = 'gg')
```
Here we can see the nearby regions of this monitor are not correlated - signified 
by the white color around it. However, at a distance we can see that the correlation 
between the monitor's reading is strong (red). 

Using a correlation map, we can examine the preformance of the monitor and Bluesky models. 
Ideally, we'd like to investigate further to compare such correlations. 


-- Mazama Science

