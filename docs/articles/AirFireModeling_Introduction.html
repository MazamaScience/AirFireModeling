<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to AirFireModeling • AirFireModeling</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to AirFireModeling">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">AirFireModeling</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.11</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/AirFireModeling_Introduction.html">Introduction to AirFireModeling</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to AirFireModeling</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2020-04-02</h4>
      
      
      <div class="hidden name"><code>AirFireModeling_Introduction.Rmd</code></div>

    </div>

    
    
<div id="overview" class="section level2">
<h2 class="hasAnchor">
<a href="#overview" class="anchor"></a>Overview</h2>
<p>The USFS Pacific Wildland Fire Sciences Lab AirFire team works to model wildland fire emissions and has created the BlueSky Modeling Framework. This system integrates a wide collection of models along the smoke modeling chain (fire information, fuel loadings, consumption modeling, emissions modeling, time rate of emissions modeling, plume height estimations, and smoke trajectory and dispersion modeling). The <em>AirFireModeling</em> package was created to make it easy to ingest and manipulate BluesSky model data in <em>R</em>. When combined with the <em>PWFSLSmoke</em> and <em>MazamaSpatialUtils</em> packages, this allowing direct comparison of model and regulatory monitoring data.</p>
<p>This article is meant to introduce <em>AirFireModeling</em> basic functionality, concepts, and terminology, and is not meant to be an exhaustive tutorial.</p>
</div>
<div id="preparation" class="section level2">
<h2 class="hasAnchor">
<a href="#preparation" class="anchor"></a>Preparation</h2>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(PWFSLSmoke)</a>
<a class="sourceLine" id="cb1-2" data-line-number="2"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(AirFireModeling)</a>
<a class="sourceLine" id="cb1-3" data-line-number="3"></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="co"># Spatial utils are required by the raster_toMonitor() function</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(MazamaSpatialUtils)</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">PWFSLSmoke<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/initializeMazamaSpatialUtils.html">initializeMazamaSpatialUtils</a></span>()</a>
<a class="sourceLine" id="cb1-7" data-line-number="7"></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="co"># Set the directory to download to and load models from</span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="kw"><a href="../reference/setModelDataDir.html">setModelDataDir</a></span>(<span class="st">'~/Data/BlueSky'</span>)</a></code></pre></div>
</div>
<div id="loading-bluesky-models" class="section level2">
<h2 class="hasAnchor">
<a href="#loading-bluesky-models" class="anchor"></a>Loading BlueSky models</h2>
<p>The <em>AirFireModeling</em> package offers consistent and flexible model loading functions. The <code><a href="../reference/bluesky_load.html">bluesky_load()</a></code> function can be used to load data from a single model run. The return type will be a <code>RasterBrick</code> which can then be manipulated with the <em>raster</em> package.</p>
<p>The <code><a href="../reference/raster_load.html">raster_load()</a></code> function can be used to load output from multiple models and/or model initialization times at once. This function returns a list of <code>RasterBrick</code> objects.</p>
<p>Data are obtained from the data archive on <code>haze.airfire.org</code>. The very first time data is requested it is first downloaded to the directory specified with <code><a href="../reference/setModelDataDir.html">setModelDataDir()</a></code> and then converted from the original NetCDF format into a <code>v2</code> format that follows <a href="http://cfconventions.org">CF conventions</a>. This allows the <em>raster</em> package to work with data in “delayed evaluation” mode, vastly improving performance.</p>
<p>All future times data is requested, it will be found in the <code>modelDataDir</code>, and immediately available.</p>
<p>Also note that the <em>raster</em> package allows us to only load data from the region of interest. Although full datasets are initially downloaded and converted, data loaded into memory will include only those grid cells that lie with the boundary set by <code>xlim</code> and <code>ylim</code> parameters in the <code>~_load()</code> functions.</p>
<p>Below is an example of loading a model using the two functions:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="co"># Single model and modelRun</span></a>
<a class="sourceLine" id="cb2-2" data-line-number="2">raster &lt;-<span class="st"> </span><span class="kw"><a href="../reference/raster_load.html">raster_load</a></span>(</a>
<a class="sourceLine" id="cb2-3" data-line-number="3">  <span class="dt">model =</span> <span class="st">'PNW-1.33km'</span>, </a>
<a class="sourceLine" id="cb2-4" data-line-number="4">  <span class="dt">modelRun =</span> <span class="dv">20200325</span>,</a>
<a class="sourceLine" id="cb2-5" data-line-number="5">  <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">125</span>, <span class="dv">-115</span>),</a>
<a class="sourceLine" id="cb2-6" data-line-number="6">  <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">42</span>, <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb2-7" data-line-number="7">)</a>
<a class="sourceLine" id="cb2-8" data-line-number="8"></a>
<a class="sourceLine" id="cb2-9" data-line-number="9"><span class="co"># Multiple models at once</span></a>
<a class="sourceLine" id="cb2-10" data-line-number="10">rasterList &lt;-<span class="st"> </span><span class="kw"><a href="../reference/raster_load.html">raster_load</a></span>(</a>
<a class="sourceLine" id="cb2-11" data-line-number="11">  <span class="dt">model =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'PNW-1.33km'</span>, <span class="st">'PNW-4km'</span>), </a>
<a class="sourceLine" id="cb2-12" data-line-number="12">  <span class="dt">modelRun =</span> <span class="dv">20200325</span>,</a>
<a class="sourceLine" id="cb2-13" data-line-number="13">  <span class="dt">xlim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="op">-</span><span class="dv">125</span>, <span class="dv">-115</span>),</a>
<a class="sourceLine" id="cb2-14" data-line-number="14">  <span class="dt">ylim =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">42</span>, <span class="dv">50</span>)</a>
<a class="sourceLine" id="cb2-15" data-line-number="15">)</a>
<a class="sourceLine" id="cb2-16" data-line-number="16"></a>
<a class="sourceLine" id="cb2-17" data-line-number="17"><span class="co"># We could also specify modelRuns </span></a></code></pre></div>
</div>
<div id="raster-data-types" class="section level2">
<h2 class="hasAnchor">
<a href="#raster-data-types" class="anchor"></a>Raster data types</h2>
<p>When model is loaded, it takes the object type <code>Raster*</code>. Because BlueSky models are temporal in nature, each model has multiple <em>layers</em> (time slices) of gridded values, organized along a time axis. In the <em>AirFireModeling</em> package, each slice is called a <code>RasterLayer</code> object, or layer for short. Multiple layers together, such as when model runs are loaded, are called <code>RasterBrick</code> objects, or brick. Accessing a layer in a brick is effectively accessing a model-slice at a certain time. For example, to access the eleventh hour in an hourly updated model may look something like this: <code>model[[11]]</code>.</p>
</div>
<div id="maps" class="section level2">
<h2 class="hasAnchor">
<a href="#maps" class="anchor"></a>Maps</h2>
<p>Mapping is easy with the <em>AirFireModeling</em> <code><a href="../reference/raster_map.html">raster_map()</a></code> function. The <code>raster</code> object passed in can be either a single <code>RasterBrick</code> or a list of them.</p>
<div id="single-map" class="section level3">
<h3 class="hasAnchor">
<a href="#single-map" class="anchor"></a>Single Map</h3>
<p>A single map will be plotted for a single model.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="co"># Create a map from a RasterBrick</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"><span class="kw"><a href="../reference/raster_map.html">raster_map</a></span>(</a>
<a class="sourceLine" id="cb3-3" data-line-number="3">  raster, </a>
<a class="sourceLine" id="cb3-4" data-line-number="4">  <span class="dt">index =</span> <span class="dv">7</span></a>
<a class="sourceLine" id="cb3-5" data-line-number="5">)</a></code></pre></div>
<p><img src="AirFireModeling_Introduction_files/figure-html/unnamed-chunk-3-1.png" width="672"></p>
</div>
<div id="multiple-maps" class="section level3">
<h3 class="hasAnchor">
<a href="#multiple-maps" class="anchor"></a>Multiple Maps</h3>
<p>A batch map will be plotted for a batch model.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co"># Create a map from a list of RasterBricks</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="kw"><a href="../reference/raster_map.html">raster_map</a></span>(</a>
<a class="sourceLine" id="cb4-3" data-line-number="3">  rasterList, </a>
<a class="sourceLine" id="cb4-4" data-line-number="4">  <span class="dt">index =</span> <span class="dv">7</span></a>
<a class="sourceLine" id="cb4-5" data-line-number="5">)</a></code></pre></div>
<p><img src="AirFireModeling_Introduction_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co"># Could plot a single one with</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="co">#raster_map(</span></a>
<a class="sourceLine" id="cb5-3" data-line-number="3"><span class="co">#  rasterList[[1]],</span></a>
<a class="sourceLine" id="cb5-4" data-line-number="4"><span class="co">#  index = 7</span></a>
<a class="sourceLine" id="cb5-5" data-line-number="5"><span class="co">#)</span></a></code></pre></div>
<!-- ### Models and Monitors -->
<!-- Much of the functionality of the package is aimed at BlueSky model output with  -->
<!-- regulatory monitoring data. There are a couple of ways to quickly do so in  -->
<!-- *AirFireModeling* that require little knowledge of other packages and databases.  -->
<!-- Just by knowing a monitor ID that is within a BlueSky coordinate domain, we can load and compare the two traces produced by the model and regulatory monitor.  -->
<!-- We can find monitor ID's through a number of methods, but the easiest is to visit [The AirFire tools monitoring site](https://tools.airfire.org/monitoring/v4/).  -->
<!-- Here is how we can easily compare a monitor to our models. -->
<!-- ```{r} -->
<!-- raster_coordinateTrace(rasterList, monitorID = '530330057_01') -->
<!-- ``` -->
</div>
</div>
<div id="working-with-monitors" class="section level2">
<h2 class="hasAnchor">
<a href="#working-with-monitors" class="anchor"></a>Working with Monitors</h2>
<p><code>Raster*</code> objects are inherently spatial (and temporal) whereas regulatory monitors loaded via the <em>PWFSLSmoke</em> R package are primarily temporal. In order to compare a BlueSky model with monitoring data we must be able to convert between the two world views.</p>
<p>To help with this, the package has both <code><a href="../reference/raster_toMonitor.html">raster_toMonitor()</a></code> and <code><a href="../reference/monitor_toRaster.html">monitor_toRaster()</a></code> functions which allow conversion from model data to <em>PWFSLSmoke</em> <code>ws_monitor</code> objects and back again.</p>
<div id="raster-to-monitor" class="section level3">
<h3 class="hasAnchor">
<a href="#raster-to-monitor" class="anchor"></a>Raster to Monitor</h3>
<p>The <code><a href="../reference/raster_toMonitor.html">raster_toMonitor()</a></code> function allows users to specify a longitude, latitude and radius and convert all model grid cells within that radius into <em>PWFSLSmoke</em>-compatible <em>ws_monitor</em> objects. These can then be used with any functions from the <em>PWFSLSmoke</em> or <em>AirMonitorPlots</em> packages.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" data-line-number="1">model_Portland &lt;-<span class="st"> </span><span class="kw"><a href="../reference/raster_toMonitor.html">raster_toMonitor</a></span>(</a>
<a class="sourceLine" id="cb6-2" data-line-number="2">  rasterList,</a>
<a class="sourceLine" id="cb6-3" data-line-number="3">  <span class="dt">longitude =</span> <span class="fl">-122.68</span>,</a>
<a class="sourceLine" id="cb6-4" data-line-number="4">  <span class="dt">latitude =</span> <span class="fl">45.52</span>,</a>
<a class="sourceLine" id="cb6-5" data-line-number="5">  <span class="dt">count =</span> <span class="dv">15</span></a>
<a class="sourceLine" id="cb6-6" data-line-number="6">)</a>
<a class="sourceLine" id="cb6-7" data-line-number="7"></a>
<a class="sourceLine" id="cb6-8" data-line-number="8">PWFSLSmoke<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/PWFSLSmoke/man/monitor_timeseriesPlot.html">monitor_timeseriesPlot</a></span>(</a>
<a class="sourceLine" id="cb6-9" data-line-number="9">  model_Portland[[<span class="dv">1</span>]],</a>
<a class="sourceLine" id="cb6-10" data-line-number="10"> <span class="dt">type =</span> <span class="st">'l'</span>, <span class="dt">col =</span> <span class="st">'salmon'</span></a>
<a class="sourceLine" id="cb6-11" data-line-number="11">)</a>
<a class="sourceLine" id="cb6-12" data-line-number="12"><span class="kw"><a href="https://rdrr.io/r/graphics/title.html">title</a></span>(<span class="st">"15 Grid cells near Portland"</span>)</a></code></pre></div>
<p><img src="AirFireModeling_Introduction_files/figure-html/unnamed-chunk-5-1.png" width="672"></p>
<!-- #### Model Conversion  -->
<!-- Additionally, we can extend monitor to raster conversion to look at *PWFSLSmoke* monitors in a more spatial way. This even allows us to directly compare the *PWFSLSmoke* regulatory monitors to the BlueSky model outputs, while preserving the spatial nature of the models.  -->
<!-- ```{r} -->
<!-- # Convert ALL NW monitors to raster -->
<!-- nw_monitors <- monitor_load(startdate = 20181109, 20181111) %>%  -->
<!--   monitor_subset(stateCodes = c('WA', 'OR')) -->
<!-- nw_monitors_raster <- monitor_toRaster(nw_monitors, res = 0.25) -->
<!-- raster_map(nw_monitors_raster, index = 2, palette = 'Spectral') -->
<!-- # TODO: adjust time axis index -->
<!-- ``` -->
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>The <em>AirFireModeling</em> package is intended to simplify downloading, analyzing, and comparing spatiotemporal BlueSky Model and monitor data. The package focuses on memory efficient exploration and analysis while providing a simple and consistent syntax.</p>
<p><strong><em>Mazama Science</em></strong></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#overview">Overview</a></li>
      <li><a href="#preparation">Preparation</a></li>
      <li><a href="#loading-bluesky-models">Loading BlueSky models</a></li>
      <li><a href="#raster-data-types">Raster data types</a></li>
      <li><a href="#maps">Maps</a></li>
      <li><a href="#working-with-monitors">Working with Monitors</a></li>
      <li><a href="#conclusion">Conclusion</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Hans Martin, Rohan Aras, Zach Dingels, Jimin Kim, Jon Hagg, Rex Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
