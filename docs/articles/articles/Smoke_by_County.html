<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smoke by County • AirFireModeling</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../../bootstrap-toc.css">
<script src="../../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../../pkgdown.css" rel="stylesheet">
<script src="../../pkgdown.js"></script><meta property="og:title" content="Smoke by County">
<meta property="og:description" content="AirFireModeling">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../../index.html">AirFireModeling</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../../articles/AirFireModeling_Introduction.html">Introduction to AirFireModeling</a>
    </li>
    <li>
      <a href="../../articles/articles/Aggregation_by_Polygon.html">Aggregation by Polygon</a>
    </li>
    <li>
      <a href="../../articles/articles/Lazy_Evaluation.html">Lazy Evaluation</a>
    </li>
    <li>
      <a href="../../articles/articles/Receptor_Analysis.html">Receptor Analysis</a>
    </li>
    <li>
      <a href="../../articles/articles/Smoke_by_County.html">Smoke by County</a>
    </li>
  </ul>
</li>
<li>
  <a href="../../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Smoke_by_County_files/header-attrs-2.5/header-attrs.js"></script><link href="Smoke_by_County_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="Smoke_by_County_files/anchor-sections-1.0/anchor-sections.js"></script><script src="Smoke_by_County_files/htmlwidgets-1.5.3/htmlwidgets.js"></script><script src="Smoke_by_County_files/jquery-3.5.1/jquery.min.js"></script><link href="Smoke_by_County_files/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="Smoke_by_County_files/datatables-binding-0.16/datatables.js"></script><link href="Smoke_by_County_files/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="Smoke_by_County_files/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="Smoke_by_County_files/dt-core-1.10.20/js/jquery.dataTables.min.js"></script><link href="Smoke_by_County_files/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet">
<script src="Smoke_by_County_files/crosstalk-1.1.1/js/crosstalk.min.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Smoke by County</h1>
                        <h4 class="author">Mazama Science</h4>
            
            <h4 class="date">2021-03-12</h4>
      
      
      <div class="hidden name"><code>Smoke_by_County.Rmd</code></div>

    </div>

    
    
<p>This vignette demonstrates how to create county averages from BlueSky model runs. This is particularly relevant in the COVID-19 era where health statistics are provided on a per-county basis.</p>
<div id="spatial-data-setup" class="section level3">
<h3 class="hasAnchor">
<a href="#spatial-data-setup" class="anchor"></a>Spatial data setup</h3>
<p>The <em>MazamaSpatialUtils</em> package is already a requirement for <em>AirFireModeling</em> and is therefore already installed. We will use datasets named <code>USCensusStates</code> and <code>USCensusCounties</code>. Each of these is a <code>SpatialPolygonsDataFrame</code> (SPDF). These are “S4” objects with per-polygon data stored in the <code>@data</code> slot.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/MazamaScience/MazamaSpatialUtils">"MazamaSpatialUtils"</a></span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/setSpatialDataDir.html">setSpatialDataDir</a></span><span class="op">(</span><span class="st">"~/Data/Spatial"</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">"USCensusStates"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/MazamaSpatialUtils/man/loadSpatialData.html">loadSpatialData</a></span><span class="op">(</span><span class="st">"USCensusCounties"</span><span class="op">)</span>

<span class="va">stateCode_of_interest</span> <span class="op">&lt;-</span> <span class="st">"WA"</span>

<span class="va">state_SPDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">USCensusStates</span>, <span class="va">stateCode</span> <span class="op">==</span> <span class="va">stateCode_of_interest</span><span class="op">)</span>
<span class="va">county_SPDF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html">subset</a></span><span class="op">(</span><span class="va">USCensusCounties</span>, <span class="va">stateCode</span> <span class="op">==</span> <span class="va">stateCode_of_interest</span><span class="op">)</span></code></pre></div>
</div>
<div id="load-raster-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-raster-data" class="anchor"></a>Load raster data</h3>
<p>We will load data from a BlueSky model and create a subset for Washington state. The <code>state_PNW_4km</code> object is a “RasterBrick” with 72 layers.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">AirFireModeling</span><span class="op">)</span> <span class="co"># For base package support</span>
<span class="fu"><a href="../../reference/setModelDataDir.html">setModelDataDir</a></span><span class="op">(</span><span class="st">"~/Data/BlueSky"</span><span class="op">)</span>

<span class="va">state_PNW_4km</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../../reference/bluesky_load.html">bluesky_load</a></span><span class="op">(</span>modelName <span class="op">=</span> <span class="st">'PNW-4km'</span>, modelRun <span class="op">=</span> <span class="fl">2020091300</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/crop.html">crop</a></span><span class="op">(</span><span class="va">state_SPDF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="../../reference/raster_subsetByPolygon.html">raster_subsetByPolygon</a></span><span class="op">(</span><span class="va">state_SPDF</span><span class="op">)</span>

<span class="co"># A quick ggplot map from the AirFireModeling package</span>
<span class="fu"><a href="../../reference/raster_ggmap.html">raster_ggmap</a></span><span class="op">(</span><span class="va">state_PNW_4km</span>, index <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></code></pre></div>
<p><img src="Smoke_by_County_files/figure-html/raster_load-1.png" width="672"></p>
</div>
<div id="thematic-mapping-with-tmap" class="section level3">
<h3 class="hasAnchor">
<a href="#thematic-mapping-with-tmap" class="anchor"></a>Thematic mapping with tmap</h3>
<p>The <strong>tmap</strong> package is a brilliantly simple way to make attractive plots using both raster and spatial data. It is thoroughly described at <a href="https://mgimond.github.io/Spatial/">Intro to GIS and Spatial Analysis</a>.</p>
<p>Creating a nice looking plot is very straightforward:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mtennekes/tmap">tmap</a></span><span class="op">)</span>

<span class="co"># County boundaries with raster overlay</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">county_SPDF</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>col <span class="op">=</span> <span class="st">'white'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">state_PNW_4km</span><span class="op">[[</span><span class="fl">12</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_raster.html">tm_raster</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Layer 12"</span>,
    palette <span class="op">=</span> <span class="st">'Greys'</span>,
    alpha <span class="op">=</span> <span class="fl">0.5</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="cn">Inf</span>,<span class="fl">0</span>, <span class="fl">12</span>, <span class="fl">35</span>, <span class="fl">55</span>, <span class="fl">150</span>, <span class="fl">250</span>, <span class="fl">350</span>, <span class="cn">Inf</span><span class="op">)</span>,
    auto.palette.mapping <span class="op">=</span> <span class="cn">FALSE</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_layout.html">tm_layout</a></span><span class="op">(</span>
    title <span class="op">=</span> <span class="st">"Predicted smoke in Washington counties"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="Smoke_by_County_files/figure-html/tmap_demo-1.png" width="672"></p>
</div>
<div id="summarizing-data" class="section level3">
<h3 class="hasAnchor">
<a href="#summarizing-data" class="anchor"></a>Summarizing data</h3>
<p>We will use the powerful <code><a href="https://rdrr.io/pkg/raster/man/extract.html">raster::extract()</a></code> function from the <em>raster</em> package to summarize our data by individual polygon. In the example below, we calculate the number of grid cells within each polygon to make sure the size of counties is significantly larger than the size of the grid cells.</p>
<p>If there are few grid cells per county, averages based on grid cell midpoints will be misleading. In such a case it would be prudent to increase the spatial resolution first by using the <code><a href="https://rdrr.io/pkg/raster/man/disaggregate.html">raster::disaggregate()</a></code> function.</p>
<p><em>NOTE: Summarizing by polygon can take a while.</em></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize a single RasterLayer by polygon</span>
<span class="va">countyCellCount_SPDF</span> <span class="op">&lt;-</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>
    <span class="va">state_PNW_4km</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span>,
    <span class="va">county_SPDF</span>,
    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">}</span>, 
    sp <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># Replace newly added column name associated with this layer</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">countyCellCount_SPDF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">county_SPDF</span><span class="op">)</span>, <span class="st">"cellCount"</span><span class="op">)</span>

<span class="co"># Simple plot</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">countyCellCount_SPDF</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"cellCount"</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">500</span>, <span class="cn">Inf</span><span class="op">)</span>,
    border.col <span class="op">=</span> <span class="st">"white"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="Smoke_by_County_files/figure-html/countyCellCount-1.png" width="672"></p>
<p>Satisfied that we have enough cells per county, let’s calculate the mean value for each of the 72 timesteps in our model run.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Summarize the entire RasterBrick by polygon</span>
<span class="va">countyMean_SPDF</span> <span class="op">&lt;-</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>
    <span class="va">state_PNW_4km</span>,
    <span class="va">county_SPDF</span>,
    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">}</span>,
    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
    sp <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># NOTE:  72 additional columns have been added, one per RasterBrick layer</span>
<span class="co"># NOTE:  (i.e. timestep). Here we give them sensible column names.</span>

<span class="co"># Replace additional columns with timestamps</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">countyMean_SPDF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">county_SPDF</span><span class="op">)</span>,
  <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span><span class="op">(</span><span class="fu"><a href="../../reference/raster_getTime.html">raster_getTime</a></span><span class="op">(</span><span class="va">state_PNW_4km</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Simple plot for 2018-11-09 03:00</span>
<span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_shape.html">tm_shape</a></span><span class="op">(</span><span class="va">countyMean_SPDF</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/tmap/man/tm_polygons.html">tm_polygons</a></span><span class="op">(</span>
    col <span class="op">=</span> <span class="st">"2020-09-13 12:00:00"</span>,
    breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">50</span>, <span class="fl">100</span>, <span class="fl">200</span>, <span class="fl">500</span>, <span class="cn">Inf</span><span class="op">)</span>,
    border.col <span class="op">=</span> <span class="st">"white"</span>
  <span class="op">)</span></code></pre></div>
<p><img src="Smoke_by_County_files/figure-html/countyMean-1.png" width="672"></p>
</div>
<div id="static-table" class="section level3">
<h3 class="hasAnchor">
<a href="#static-table" class="anchor"></a>Static table</h3>
<p>Let’s finish things up with a table or two. First up, we can generate a nicely formatted static table using <code><a href="https://rdrr.io/pkg/knitr/man/kable.html">knitr::kable()</a></code>:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Get the model timesteps </span>
<span class="va">layerTimes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../../reference/raster_getTime.html">raster_getTime</a></span><span class="op">(</span><span class="va">state_PNW_4km</span><span class="op">)</span>

<span class="co"># Get the SPDF names associated with those timesteps</span>
<span class="va">layerNames</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">countyMean_SPDF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="st">"^[0-9]"</span><span class="op">)</span>
  
<span class="co"># Extract summary data and transpose</span>
<span class="va">timeByCounty_Matrix</span> <span class="op">&lt;-</span>
  <span class="va">countyMean_SPDF</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="va">layerNames</span><span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="op">)</span> 

<span class="co"># Add county names to the columns and then add a 'datetime' column</span>
<span class="va">timeByCounty_DF</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">timeByCounty_Matrix</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">timeByCounty_DF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">countyMean_SPDF</span><span class="op">$</span><span class="va">name</span>
<span class="va">timeByCounty_DF</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span>datetime <span class="op">=</span> <span class="va">layerTimes</span>, <span class="va">timeByCounty_DF</span><span class="op">)</span>

<span class="co"># Look at a portion of the new dataframe</span>
<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html">kable</a></span><span class="op">(</span>
  <span class="va">timeByCounty_DF</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span>,<span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>,
  format <span class="op">=</span> <span class="st">"markdown"</span>,
  digits <span class="op">=</span> <span class="fl">0</span>
<span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">datetime</th>
<th align="right">…2</th>
<th align="right">…3</th>
<th align="right">…4</th>
<th align="right">…5</th>
<th align="right">…6</th>
<th align="right">…7</th>
<th align="right">…8</th>
<th align="right">…9</th>
<th align="right">…10</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">2020-09-13 01:00:00</td>
<td align="left">2020-09-13 01:00:00</td>
<td align="right">3</td>
<td align="right">153</td>
<td align="right">61</td>
<td align="right">37</td>
<td align="right">237</td>
<td align="right">17</td>
<td align="right">198</td>
<td align="right">36</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2020-09-13 02:00:00</td>
<td align="left">2020-09-13 02:00:00</td>
<td align="right">0</td>
<td align="right">146</td>
<td align="right">69</td>
<td align="right">26</td>
<td align="right">263</td>
<td align="right">20</td>
<td align="right">157</td>
<td align="right">20</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="left">2020-09-13 03:00:00</td>
<td align="left">2020-09-13 03:00:00</td>
<td align="right">0</td>
<td align="right">203</td>
<td align="right">110</td>
<td align="right">15</td>
<td align="right">354</td>
<td align="right">16</td>
<td align="right">155</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2020-09-13 04:00:00</td>
<td align="left">2020-09-13 04:00:00</td>
<td align="right">0</td>
<td align="right">301</td>
<td align="right">160</td>
<td align="right">9</td>
<td align="right">457</td>
<td align="right">7</td>
<td align="right">140</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2020-09-13 05:00:00</td>
<td align="left">2020-09-13 05:00:00</td>
<td align="right">0</td>
<td align="right">356</td>
<td align="right">216</td>
<td align="right">9</td>
<td align="right">680</td>
<td align="right">8</td>
<td align="right">125</td>
<td align="right">8</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">2020-09-13 06:00:00</td>
<td align="left">2020-09-13 06:00:00</td>
<td align="right">0</td>
<td align="right">472</td>
<td align="right">393</td>
<td align="right">13</td>
<td align="right">807</td>
<td align="right">8</td>
<td align="right">132</td>
<td align="right">7</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">2020-09-13 07:00:00</td>
<td align="left">2020-09-13 07:00:00</td>
<td align="right">0</td>
<td align="right">562</td>
<td align="right">630</td>
<td align="right">14</td>
<td align="right">697</td>
<td align="right">10</td>
<td align="right">132</td>
<td align="right">9</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="left">2020-09-13 08:00:00</td>
<td align="left">2020-09-13 08:00:00</td>
<td align="right">0</td>
<td align="right">589</td>
<td align="right">875</td>
<td align="right">15</td>
<td align="right">491</td>
<td align="right">20</td>
<td align="right">143</td>
<td align="right">11</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">2020-09-13 09:00:00</td>
<td align="left">2020-09-13 09:00:00</td>
<td align="right">0</td>
<td align="right">598</td>
<td align="right">1151</td>
<td align="right">12</td>
<td align="right">314</td>
<td align="right">37</td>
<td align="right">160</td>
<td align="right">13</td>
<td align="right">4</td>
</tr>
<tr class="even">
<td align="left">2020-09-13 10:00:00</td>
<td align="left">2020-09-13 10:00:00</td>
<td align="right">0</td>
<td align="right">507</td>
<td align="right">1434</td>
<td align="right">8</td>
<td align="right">204</td>
<td align="right">48</td>
<td align="right">161</td>
<td align="right">16</td>
<td align="right">3</td>
</tr>
</tbody>
</table>
</div>
<div id="interactive-table" class="section level3">
<h3 class="hasAnchor">
<a href="#interactive-table" class="anchor"></a>Interactive table</h3>
<p>Or, we can show daily averages by county in an interactive table. The <strong>DT</strong> package allows for easy creation of javascript based interactive tables. This time we use counties as rows and show daily averages as columns.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Create (UTC) daily averages</span>
<span class="va">dailyMean_PNW_4km</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/stackApply.html">stackApply</a></span><span class="op">(</span>
  <span class="va">state_PNW_4km</span>,
  indices <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">23</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">2</span>,<span class="fl">24</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">24</span><span class="op">)</span><span class="op">)</span>, 
  fun <span class="op">=</span> <span class="va">mean</span>
<span class="op">)</span>

<span class="co"># Provide better names for the RasterBrick layers</span>
<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">dailyMean_PNW_4km</span><span class="op">)</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span><span class="op">(</span>
    <span class="st">"mean_for_%s"</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/strptime.html">strftime</a></span><span class="op">(</span><span class="va">layerTimes</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">24</span>,<span class="fl">48</span><span class="op">)</span><span class="op">]</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>
  <span class="op">)</span>

<span class="co"># Extract per county means</span>
<span class="va">countyDailyMean_SPDF</span> <span class="op">&lt;-</span>
  <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/extract.html">extract</a></span><span class="op">(</span>
    <span class="va">dailyMean_PNW_4km</span>,
    <span class="va">county_SPDF</span>,
    fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">...</span><span class="op">)</span> <span class="op">}</span>,
    na.rm <span class="op">=</span> <span class="cn">TRUE</span>,
    sp <span class="op">=</span> <span class="cn">TRUE</span>
  <span class="op">)</span>

<span class="co"># Get the SPDF names associated with the layers (daily timesteps)</span>
<span class="va">layerNames</span> <span class="op">&lt;-</span>
  <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span><span class="op">(</span><span class="va">countyDailyMean_SPDF</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_subset.html">str_subset</a></span><span class="op">(</span><span class="st">"^mean_for_"</span><span class="op">)</span>

<span class="co"># Extract daily averages and transpose</span>
<span class="va">dayByCountyData_DF</span> <span class="op">&lt;-</span>
  <span class="va">countyDailyMean_SPDF</span><span class="op">@</span><span class="va">data</span><span class="op">[</span>, <span class="va">layerNames</span><span class="op">]</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/Round.html">round</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span>

<span class="co"># Improve the dataframe</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dayByCountyData_DF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dayByCountyData_DF</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">stringr</span><span class="fu">::</span><span class="fu"><a href="https://stringr.tidyverse.org/reference/str_replace.html">str_replace</a></span><span class="op">(</span><span class="va">layerNames</span>, <span class="st">"mean_for_"</span>, <span class="st">""</span><span class="op">)</span>
<span class="va">dayByCounty_DF</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html">bind_cols</a></span><span class="op">(</span>county <span class="op">=</span> <span class="va">county_SPDF</span><span class="op">$</span><span class="va">name</span>, <span class="va">dayByCountyData_DF</span><span class="op">)</span>

<span class="co"># Display as an interactive table</span>
<span class="fu">DT</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/DT/man/datatable.html">datatable</a></span><span class="op">(</span><span class="va">dayByCounty_DF</span><span class="op">)</span></code></pre></div>
<div id="htmlwidget-4f06d1eab5b5486886fe" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-4f06d1eab5b5486886fe">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39"],[29.4,275.8,933.4,12.5,328.8,188.6,136.5,67.4,5,31.4,6.7,109.9,48.2,81,17,57.9,41.1,544.9,19.5,83,68.2,11.6,153,26.7,18.3,45.8,96.8,103.1,106.9,280.3,268.7,128.6,307.9,19.9,431,7.2,45.8,4.6,282.4],[0.3,180.7,74.8,0,349.6,4.2,53.8,0.4,0.1,5.2,1.7,121.3,17.5,4.2,0,10.1,26.4,261.3,2.5,67,7.4,0,85.2,12,25.5,18.7,13.4,24.7,29.1,75.2,205.2,50.5,144.7,0,23.9,0.2,8.5,0.7,170.7],[39.2,236.7,499.4,43.9,397.5,199.9,76.6,111.8,12.8,17,2.4,401.7,37.9,172.4,62.5,18.4,34.3,356.3,22.4,95.9,55.4,22.6,49,22.7,54.4,24.4,30.1,66.5,55.5,230.7,394.2,71.5,215,161.1,303.6,7.9,8.9,4.5,318.4]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>2020.09.12<\/th>\n      <th>2020.09.13<\/th>\n      <th>2020.09.14<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"columnDefs":[{"className":"dt-right","targets":[1,2,3]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":[],"jsHooks":[]}</script>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Jonathan Callahan, Tate Brasel, Hans Martin, Rohan Aras, Zach Dingels, Jimin Kim, Jon Hagg, Rex Thompson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
